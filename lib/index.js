(()=>{"use strict";var t={d:(e,r)=>{for(var i in r)t.o(r,i)&&!t.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:r[i]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},e={};t.r(e),t.d(e,{default:()=>f});var r=["$eq","$gt","$gte","$in","$lt","$lte","$ne","$nin"],i=function(t){return"number"!=typeof t},n={$eq:function(t,e){return e===t},$gt:function(t,e){if(i(t))throw new Error("'$gt' value must be a number");return e>t},$gte:function(t,e){if(i(t))throw new Error("'$gte' value must be a number");return e>=t},$in:function(t,e){if(!(t instanceof Array))throw new Error("'$in' value must be an array");return t.includes(e)},$lt:function(t,e){if(i(t))throw new Error("'$lt' value must be a number");return e<t},$lte:function(t,e){if(i(t))throw new Error("'$lte' value must be a number");return e<=t},$ne:function(t,e){return e!==t},$nin:function(t,e){if(!(t instanceof Array))throw new Error("'$nin' value must be an array");return!t.includes(e)},_checkExist:function(t){if(r.includes(t))return!0;throw new Error("unknown operator: '"+t+"'")}},a=function(t,e){var r,i,n="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),a=[];if(e=e||n.length,t)for(r=0;r<t;r++)a[r]=n[0|Math.random()*e];else for(a[8]=a[13]=a[18]=a[23]="-",a[14]="4",r=0;r<36;r++)a[r]||(i=0|16*Math.random(),a[r]=n[19==r?3&i|8:i]);return a.join("")},o=function(t){return t instanceof Object&&"Object"===t.constructor.name},s=function(t){return t instanceof Array&&"Array"===t.constructor.name},u=function(t,e){if(!t||!Object.keys(t).length)return!0;for(var r=0,i=Object.keys(t);r<i.length;r++){var a=i[r],s=t[a],u=e[a];if(s instanceof RegExp){if(!s.test(u))return!1}else if(o(s))for(var h=0,l=Object.keys(s);h<l.length;h++){var f=l[h];if(n._checkExist(f)&&!n[f](s[f],u))return!1}else if(s!==u)return!1}return!0},h=function t(e,r,i,n,a){n=n||0;var o=(a=a||Object.keys(e))[n];return o?r[o]===i[o]?t(e,r,i,++n,a):1===e[o]?r[o]-i[o]:-1===e[o]?i[o]-r[o]:void 0:0},l=function(){function t(t,e,r){r=r||{},this.name=e,this.storage=t.storage,this.path=t.database+t.sep+e,this.primaryKey=r.primaryKey||t.primaryKey,this.cache=[],this.cacheable=!1}return t.prototype._initCache=function(){for(var t=[],e=new RegExp("^"+this.path),r=0,i=Object.keys(this.storage);r<i.length;r++){var n=i[r];e.test(n)&&(t=JSON.parse(this.storage.getItem(n)))}this.cache=t,this.cacheable=!0},t.prototype._filter=function(t,e){e.type=e.type||"data",e.multi=e.multi||!1,this.cacheable||this._initCache();var r,i=[],n="id"===e.type;if("string"==typeof t)t=new RegExp(t);else if("function"==typeof t)r=!0;else if(!t){var a=n?Object.keys(this.cache):Object.values(this.cache);return e.multi?a:a[0]||null}for(var o=0,s=Object.keys(this.cache);o<s.length;o++){var u=s[o],h=this.cache[Number(u)];if(r){if(t(u,h)){if(a=n?u:h,!e.multi)return a;i.push(a)}}else if(t.test(h[this.primaryKey])){if(a=n?u:h,!e.multi)return a;i.push(a)}}return e.multi?i:null},t.prototype.inset=function(t,e){var r,i=s(t),n=o(t);if(i){if(0===t.length)return[]}else t=[t];for(var u=this.primaryKey,h=this.cacheable,l=JSON.parse(this.storage.getItem(this.path)||"[]"),f=0,c=t;f<c.length;f++){var p=c[f];if(!n&&!i)throw new Error("TypeError: insert data must be an object or an object array");void 0!==p[u]&&0!==(null===(r=p[u])||void 0===r?void 0:r.length)||(p[u]=a()),p.createdTime||(p.createdTime=new Date,p.updatedTime=""),h&&(this.cache=l.concat(p)),this.storage.setItem(this.path,JSON.stringify(l.concat(p)))}return i?t:t[0]},t.prototype.find=function(t,e){var r;t=t||{},(e=e||{}).skip=e.skip||0,e.limit=e.limit,e.sort=e.sort,s(e.sort)&&(e.sort=e.sort.reduce((function(t,e){return"string"==typeof e?t[e]=1:e instanceof Array&&e.length&&(t[e[0]]=e[1]||1),t}),{}));var i=o(t)?null:s(t)?t:[t],n={type:e._filterType||"data",multi:!0};if(i){var a=new RegExp("^"+i.join("|")+"$");r=this._filter(a,n)}else r=Object.keys(t).length?this._filter((function(e,r){return u(t,r)}),n):this._filter(null,n);return e.sort&&r.sort((function(t,r){return h(null==e?void 0:e.sort,t,r)})),e.limit?r=r.slice(e.skip,e.skip+e.limit):e.skip&&(r=r.slice(e.skip)),r},t.prototype.findOne=function(t,e){var r,i=this;e=e||{};var n=o(t=t||{})?null:t,a=t?Object.keys(t):[],s=!1,h=!!e.sort,l={type:e._filterType||"data",multi:!1};if(a.length&&a.includes(this.primaryKey)&&(n=t[this.primaryKey],s=!0),n){if((r=(r=this.storage.getItem(this.path))?JSON.parse(r):null)&&s&&!u(t,r))return null;r=r?r.find((function(t){return t[i.primaryKey]===n})):void 0}else r=a.length?h?this.find(t,e):this._filter((function(e,r){return u(t,r)}),l):h?this.find(t,e):this._filter(null,l);return!n&&h&&r&&(r=r[0]||null),r},t.prototype.remove=function(t,e){var r=this;if(!t)throw new Error("remove needs a query");(e=e||{}).multi=void 0===e.multi||e.multi;var i=JSON.parse(this.storage.getItem(this.path)),n=e.multi?this.find(t,{_filterType:"data"}):this.findOne(t,{_filterType:"data"}),a=this.cacheable;if(e.mulit&&!n.length||!e.mulit&&!n)return 0;e.multi||(n=[n]);for(var o=function(t){a&&(s.cache=s.cache.filter((function(e){return e[r.primaryKey]!==t[r.primaryKey]}))),i=i.filter((function(e){return e[r.primaryKey]!==t[r.primaryKey]})),s.storage.setItem(s.path,JSON.stringify(i))},s=this,u=0,h=n;u<h.length;u++)o(h[u]);return n.length},t.prototype.update=function(t,e,r){if(!t)throw new Error("update needs a query");if(!e||!o(e))throw new Error("update needs an object");(r=r||{}).multi=void 0!==r.multi&&r.multi;var i=this.primaryKey,n=this.cacheable;e[i]&&delete e[i];var a=r.multi?this.find(t,{_filterType:(null==r?void 0:r._filterType)||"data"}):this.findOne(t,{_filterType:(null==r?void 0:r._filterType)||"data"});if(r.mulit&&!a.length||!r.mulit&&!a)return 0;if(r.multi){delete e[i];var s=a;return(u=JSON.parse(this.storage.getItem(this.path)))?(u=u.map((function(t){return s.forEach((function(r){if(t[i]===r[i])for(var n in e)t[n]=e[n],t.updatedTime=new Date})),t})),n&&(this.cache=u),this.storage.setItem(this.path,JSON.stringify(u)),a.length):null}var u,h=a;return(u=JSON.parse(this.storage.getItem(this.path)))?(u=u.map((function(t){if(t[i]===h[i])for(var r in e)t[r]=e[r],t.updatedTime=new Date;return t})),this.storage.setItem(this.path,JSON.stringify(u)),n&&(this.cache=u),u):null},t.prototype.drop=function(){return this.remove({}),!0},t.prototype.count=function(){var t=this.storage.getItem(this.path);return t?JSON.parse(t).length:void 0},t}();const f=function(){function t(t){this.storage=t.storage||window&&window.localStorage,this.database=t.database||"db",this.primaryKey=t.primaryKey||"_id",this.sep=t.sep||":",function(t){if(!(t&&t instanceof Object))return!1;try{return t.setItem("_supported","1"),t.removeItem("_supported"),!0}catch(t){return!1}}(this.storage)||(this.storage=null)}return t.prototype.get=function(t,e){return new l(this,t,e||{storage:this.storage,database:this.database,primaryKey:this.primaryKey,sep:this.sep})},t.prototype.collection=function(t,e){return this.get(t,e)},t.prototype.size=function(){var t=0;for(var e in this.storage)if(this.storage.hasOwnProperty(e)&&-1!==e.indexOf(this.database+":")){var r=this.storage.getItem(e);t+=r?r.length:0}return t},t}()})();